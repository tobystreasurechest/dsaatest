<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fraud Detection Dashboard</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 40px; }
    .chart-container { max-width: 1000px; margin: 0 auto; }
    svg { background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="chart-container">
    <h1>Fraud Detection Metrics</h1>
    <button onclick="loadData()">Reload Data</button>
    <div id="chart"></div>
  </div>

  <script>
    let data = [];
    
    async function loadData() {
      try {
        const response = await fetch('sample.json');
        data = await response.json();
        updateChart(data.slice(-20));
      } catch (error) {
        console.error('Load failed:', error);
      }
    }
    
    // Initial load
    loadData();
    
    // D3 chart setup (same as previous examples)
    const svg = d3.select('#chart').append('svg')
      .attr('viewBox', '0 0 1000 600')
      .attr('preserveAspectRatio', 'xMidYMid meet');
    
    const margin = {top: 20, right: 30, bottom: 100, left: 80};
    const width = 1000 - margin.left - margin.right;
    const height = 600 - margin.top - margin.bottom;
    
    const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
    const x = d3.scaleBand().range([0, width]).padding(0.1);
    const y = d3.scaleLinear().range([height, 0]);
    const z = d3.scaleOrdinal(d3.schemeAccent);
    
    const xAxis = g.append('g').attr('transform', `translate(0,${height})`);
    const yAxis = g.append('g');
    
    function updateChart(data) {
      data.forEach(d => d.date = new Date(d.timestamp));
      x.domain(data.map(d => d3.timeFormat('%H:%M')(d.date)));
      y.domain([0, d3.max(data, d => d.value)]);
      z.domain(data.map(d => d.category));
      
      xAxis.transition().call(d3.axisBottom(x).tickSizeOuter(0))
        .selectAll('text').style('text-anchor', 'end').attr('dx', '-.8em').attr('dy', '.15em').attr('transform', 'rotate(-45)');
      
      yAxis.transition().call(d3.axisLeft(y).tickSize(-width))
        .selectAll('line').attr('stroke', '#f0f0f0');
      
      const bars = g.selectAll('rect').data(data, d => d.timestamp);
      bars.exit().transition().duration(500).attr('y', y(0)).attr('height', 0).remove();
      
      bars.enter().append('rect')
        .attr('fill', d => z(d.category))
        .attr('x', width).attr('width', 0).attr('y', y(0)).attr('height', 0)
        .merge(bars).transition().duration(1000)
        .attr('x', d => x(d3.timeFormat('%H:%M')(d.date)))
        .attr('width', x.bandwidth())
        .attr('y', d => y(d.value))
        .attr('height', d => height - y(d.value));
    }
  </script>
</body>
</html>
